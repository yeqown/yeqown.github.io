<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="è™½ç„¶ç°åœ¨ memcached ä¸æ˜¯å½“ä¸‹æœ€æµè¡Œçš„ç¼“å­˜ç³»ç»Ÿï¼Œä½†æ˜¯èƒœåœ¨ç®€å•ã€‚äº†è§£å…¶åè®®è®¾è®¡å’Œä½¿ç”¨åœºæ™¯ï¼Œå¯¹äºæ¶æ„è®¾è®¡ä¹Ÿä¼šæœ‰ä¸€äº›å¸®åŠ©ã€‚æœ¬æ–‡é€šè¿‡æŠ“åŒ…çš„æ–¹å¼æ¥åˆ†æ memcached çš„åè®®äº¤äº’è¿‡ç¨‹ï¼Œå†ç»“åˆä¸€éƒ¨åˆ†æºç æ¥åˆ†æä¸‹ memcached æ˜¯æ€ä¹ˆæ”¯æŒâ€œåˆ†å¸ƒå¼â€åœºæ™¯çš„ã€‚">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://www.yeqown.xyz/2025/01/03/%E9%80%9A%E8%BF%87%E4%B8%80%E6%AC%A1%E6%8A%93%E5%8C%85%E6%9D%A5%E6%8E%8C%E6%8F%A1memcached/">
  <meta property="og:site_name" content="Yeqown">
  <meta property="og:title" content="é€šè¿‡ä¸€æ¬¡æŠ“åŒ…æ¥æŒæ¡memcached">
  <meta property="og:description" content="è™½ç„¶ç°åœ¨ memcached ä¸æ˜¯å½“ä¸‹æœ€æµè¡Œçš„ç¼“å­˜ç³»ç»Ÿï¼Œä½†æ˜¯èƒœåœ¨ç®€å•ã€‚äº†è§£å…¶åè®®è®¾è®¡å’Œä½¿ç”¨åœºæ™¯ï¼Œå¯¹äºæ¶æ„è®¾è®¡ä¹Ÿä¼šæœ‰ä¸€äº›å¸®åŠ©ã€‚æœ¬æ–‡é€šè¿‡æŠ“åŒ…çš„æ–¹å¼æ¥åˆ†æ memcached çš„åè®®äº¤äº’è¿‡ç¨‹ï¼Œå†ç»“åˆä¸€éƒ¨åˆ†æºç æ¥åˆ†æä¸‹ memcached æ˜¯æ€ä¹ˆæ”¯æŒâ€œåˆ†å¸ƒå¼â€åœºæ™¯çš„ã€‚">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-01-03T20:49:24+08:00">
    <meta property="article:modified_time" content="2025-01-03T20:49:24+08:00">
    <meta property="article:tag" content="Memcached">
    <meta property="article:tag" content="Tcpdump">
    <meta property="article:tag" content="Wireshark">
    <meta property="article:tag" content="Rendezvous Hashing">
<title>é€šè¿‡ä¸€æ¬¡æŠ“åŒ…æ¥æŒæ¡memcached | Yeqown</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://www.yeqown.xyz/2025/01/03/%E9%80%9A%E8%BF%87%E4%B8%80%E6%AC%A1%E6%8A%93%E5%8C%85%E6%9D%A5%E6%8E%8C%E6%8F%A1memcached/">
<link rel="stylesheet" href="/book.min.c2fbf3db843e2f212ac724c116ea0973ae0c44d9926b1c14e16b29de812a6dc5.css" integrity="sha256-wvvz24Q&#43;LyEqxyTBFuoJc64MRNmSaxwU4Wsp3oEqbcU=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.f17080086de35ea2d8ae7bbe8fd7dfab7183b485730a9353be99f4f0986495e5.js" integrity="sha256-8XCACG3jXqLYrnu&#43;j9ffq3GDtIVzCpNTvpn08JhkleU=" crossorigin="anonymous"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade"><!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Yeqown</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>







  
<ul>
  
  <li>
    <a href="/categories"  target="_blank" rel="noopener">
        Categories
      </a>
  </li>
  
  <li>
    <a href="/tags"  target="_blank" rel="noopener">
        Tags
      </a>
  </li>
  
</ul>










  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/aboutme/" class="">About Me</a>
  

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>é€šè¿‡ä¸€æ¬¡æŠ“åŒ…æ¥æŒæ¡memcached</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#ä»€ä¹ˆæ˜¯-memcachedhttpsmemcachedorg">ä»€ä¹ˆæ˜¯ <a href="https://memcached.org/">memcached</a></a>
      <ul>
        <li><a href="#ä¸ºä»€ä¹ˆæœ‰-redis-è¿˜è¦ä½¿ç”¨-memcached">ä¸ºä»€ä¹ˆæœ‰ redis è¿˜è¦ä½¿ç”¨ memcached</a></li>
      </ul>
    </li>
    <li><a href="#memcached-åè®®æ¦‚è§ˆ">memcached åè®®æ¦‚è§ˆ</a>
      <ul>
        <li><a href="#standard-text-protocol">Standard Text Protocol</a></li>
        <li><a href="#meta-text-protocol">Meta Text Protocol</a></li>
      </ul>
    </li>
    <li><a href="#æŠ“åŒ…æºç åˆ†æ">æŠ“åŒ…/æºç åˆ†æ</a>
      <ul>
        <li><a href="#åˆ†æ0-memcached-çš„åè®®é•¿ä»€ä¹ˆæ ·">åˆ†æ0: memcached çš„åè®®é•¿ä»€ä¹ˆæ ·ï¼Ÿ</a></li>
        <li><a href="#åˆ†æ1-memcached-é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„">åˆ†æ1: memcached é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</a></li>
        <li><a href="#åˆ†æ2-å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«">åˆ†æ2: å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li>
      </ul>
    </li>
    <li><a href="#æ–‡æœ¬åè®®æ¢³ç†">æ–‡æœ¬åè®®æ¢³ç†</a></li>
    <li><a href="#memcached-client-å®ç°">Memcached Client å®ç°</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h2>
    é€šè¿‡ä¸€æ¬¡æŠ“åŒ…æ¥æŒæ¡memcached
  </h2>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/svg/calendar.svg" class="book-icon " alt="" />
    <span>January 3, 2025</span>
  </div>



  
  <div class="text-small">
    
      <a href="/categories/%E6%80%BB%E7%BB%93/">æ€»ç»“</a>, 
      <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">åˆ†å¸ƒå¼</a>
  </div>
  

  
  <div class="text-small">
    
      <a href="/tags/memcached/">Memcached</a>, 
      <a href="/tags/tcpdump/">Tcpdump</a>, 
      <a href="/tags/wireshark/">Wireshark</a>, 
      <a href="/tags/Rendezvous-Hashing/">Rendezvous Hashing</a>
  </div>
  


  <div class="book-post-content"><h2 id="ä»€ä¹ˆæ˜¯-memcachedhttpsmemcachedorg">
  ä»€ä¹ˆæ˜¯ <a href="https://memcached.org/">memcached</a>
  <a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af-memcachedhttpsmemcachedorg">#</a>
</h2>
<p>memcached æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„â€œåˆ†å¸ƒå¼â€å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿï¼Œç”¨äºåŠ¨æ€ Web åº”ç”¨ä»¥å‡è½»æ•°æ®åº“è´Ÿè½½ã€‚å®ƒé€šè¿‡åœ¨å†…å­˜ä¸­ç¼“å­˜æ•°æ®å’Œå¯¹è±¡æ¥å‡å°‘è¯»å–æ•°æ®åº“çš„æ¬¡æ•°ï¼Œä»è€Œæé«˜åŠ¨æ€ã€æ•°æ®åº“é©±åŠ¨ç½‘ç«™çš„é€Ÿåº¦ã€‚memcached æ˜¯è‡ªç”±è½¯ä»¶ï¼Œä»¥ BSD è®¸å¯è¯å‘å¸ƒã€‚</p>
<p>ç›¸æ¯”äºå¤§å®¶ç†ŸçŸ¥çš„ Redisï¼Œmemcached æ›´åŠ ç®€å•ï¼Œåªæ”¯æŒ key-value å­˜å‚¨ï¼Œè€Œ Redis æ”¯æŒæ›´å¤šçš„æ•°æ®ç»“æ„ï¼Œå¦‚ listã€setã€hash ç­‰ã€‚</p>
<blockquote>
<p>Github åœ°å€ï¼š<a href="https://github.com/memcached/memcached">https://github.com/memcached/memcached</a></p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆæœ‰-redis-è¿˜è¦ä½¿ç”¨-memcached">
  ä¸ºä»€ä¹ˆæœ‰ redis è¿˜è¦ä½¿ç”¨ memcached
  <a class="anchor" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%9c%89-redis-%e8%bf%98%e8%a6%81%e4%bd%bf%e7%94%a8-memcached">#</a>
</h3>
<p>ä»æˆ‘ä¸ªäººçš„è§’åº¦æ¥è¯´ï¼Œè¦åœ¨é‡‡ç”¨ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿçš„æ—¶å€™ï¼Œæˆ‘ä¼šä¼˜å…ˆé€‰æ‹© Redisï¼Œå› ä¸º Redis åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œæ”¯æŒæ›´å¤šçš„æ•°æ®ç»“æ„ï¼Œè€Œä¸” Redis ä¹Ÿæ”¯æŒæŒä¹…åŒ–ï¼Œåœ¨é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼éƒ¨åˆ†çš„è®¾è®¡ä¸Šä¹Ÿæ›´åŠ å®Œå–„ã€‚</p>
<p>ä½†æ˜¯ memcached ä¹Ÿæœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼Œæ¯”å¦‚æ›´åŠ ç®€å•ï¼Œæ›´åŠ è½»é‡çº§ï¼Œæ›´åŠ å®¹æ˜“ä¸Šæ‰‹ï¼Œå› æ­¤åœ¨æŸäº›ç³»ç»Ÿä¸­ä¹Ÿä¼šé€‰ç”¨ memcachedã€‚å› æ­¤ï¼Œäº†è§£ memcached çš„è®¾è®¡ä¹Ÿæ˜¯æœ‰å¿…è¦çš„ã€‚</p>
<h2 id="memcached-åè®®æ¦‚è§ˆ">
  memcached åè®®æ¦‚è§ˆ
  <a class="anchor" href="#memcached-%e5%8d%8f%e8%ae%ae%e6%a6%82%e8%a7%88">#</a>
</h2>
<p>memcached æ”¯æŒåŸºæœ¬çš„æ–‡æœ¬åè®®å’Œ<a href="https://docs.memcached.org/protocols/meta/">å…ƒæ–‡æœ¬åè®®</a>ï¼Œå…¶ä¸­å…ƒæ–‡æœ¬åè®®äº 2019 å¹´æ¨å‡ºã€‚memcached è¿˜æ›¾æ”¯æŒè¿‡äºŒè¿›åˆ¶åè®®ï¼Œä½†å·²ç»è¢«åºŸå¼ƒã€‚</p>
<blockquote class="book-hint info">
<p>memcached çš„åè®®æ˜¯åŸºäºæ–‡æœ¬çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ telnet æˆ–è€… netcat å·¥å…·æ¥æ¨¡æ‹Ÿ memcached çš„å®¢æˆ·ç«¯ï¼Œä»è€Œæ–¹ä¾¿çš„è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>è¿™ä¸¤è€…æ˜¯ â€œäº¤å‰å…¼å®¹â€ çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ <em><strong>æ–‡æœ¬åè®®æ¥è®¾ç½®é”®å€¼</strong></em>, é€šè¿‡ <em><strong>å…ƒæ–‡æœ¬åè®®æ¥æŸ¥è¯¢</strong></em>ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
</blockquote>
<h3 id="standard-text-protocol">
  Standard Text Protocol
  <a class="anchor" href="#standard-text-protocol">#</a>
</h3>
<blockquote>
<p>è¯¦ç»†çš„åè®®æ–‡æ¡£å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt">https://github.com/memcached/memcached/blob/master/doc/protocol.txt</a></p>
</blockquote>
<p>memcached çš„æ ‡å‡†æ–‡æœ¬åè®®æ˜¯ä¸€ä¸ªåŸºäºæ–‡æœ¬çš„åè®®ï¼Œå®ƒä½¿ç”¨ ASCII å­—ç¬¦ä¸²æ¥è¿›è¡Œé€šä¿¡ã€‚memcached æœåŠ¡å™¨ç›‘å¬åœ¨é»˜è®¤ç«¯å£ 11211 ä¸Šï¼Œå®¢æˆ·ç«¯é€šè¿‡ TCP è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œç„¶åå‘é€å‘½ä»¤å’Œæ•°æ®ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡ telnet å·¥å…·å°±å¯ä»¥å®Œæˆ memcached çš„åŸºæœ¬æ“ä½œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>telnet 127.0.0.1 <span style="color:#ae81ff">11211</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å¯ä»¥è¾“å…¥ memcached çš„å‘½ä»¤ï¼Œå¦‚ <code>set</code>ã€<code>get</code> ç­‰ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>set key <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span> <span style="color:#75715e"># set key flag expire_time data_length</span>
</span></span><span style="display:flex;"><span>value         <span style="color:#75715e"># data</span>
</span></span><span style="display:flex;"><span>STORED       <span style="color:#75715e"># è¡¨ç¤ºå­˜å‚¨æˆåŠŸ</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>get key
</span></span><span style="display:flex;"><span>VALUE key <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">5</span> <span style="color:#75715e"># VALUE key flag data_length CAS</span>
</span></span><span style="display:flex;"><span>value         <span style="color:#75715e"># data</span>
</span></span><span style="display:flex;"><span>END           <span style="color:#75715e"># è¡¨ç¤ºè·å–ç»“æŸ</span>
</span></span></code></pre></div><h4 id="storage-commands">
  Storage Commands
  <a class="anchor" href="#storage-commands">#</a>
</h4>
<p>å­˜å‚¨å‘½ä»¤åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å­˜å‚¨å‘½ä»¤ï¼ˆset, add, replace, append å’Œ prependï¼‰ï¼Œå¦ä¸€ç±»æ˜¯æ£€æŸ¥å¹¶è®¾ç½®å‘½ä»¤ï¼ˆcasï¼‰ã€‚å„è‡ªçš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>ç›´æ¥å­˜å‚¨å‘½ä»¤</p>
<p><code>&lt;command name&gt; &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; [noreply]\r\n &lt;data block&gt; \r\n</code></p>
<ul>
<li>key: å®¢æˆ·ç«¯å£°æ˜çš„ç”¨äºå­˜å‚¨çš„ key</li>
<li>flags: ä»»æ„çš„ 16 ä½æ— ç¬¦å·æ•´æ•°ç”¨äºå­˜å‚¨é¢å¤–çš„ä¿¡æ¯ï¼Œå¯¹æœåŠ¡å™¨é€æ˜ï¼Œå½“æ•°æ®è¢«è·å–æ—¶ä¼šåŸå°ä¸åŠ¨çš„è¿”å›ã€‚åœ¨ v1.2.1 ä¹‹åï¼Œflags å¯ä»¥æ˜¯ 32 ä½æ— ç¬¦å·æ•´æ•°ã€‚</li>
<li>exptime: ä»¥ç§’ä¸ºå•ä½çš„è¿‡æœŸæ—¶é—´ï¼Œ0 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼ˆä½†ä»ç„¶å¯èƒ½ä¼šå› ä¸ºå†…å­˜ä¸è¶³è€Œè¢«åˆ é™¤ï¼‰</li>
<li>bytes: å­˜å‚¨çš„æ•°æ®é•¿åº¦</li>
<li>noreply: å¯é€‰å‚æ•°ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸ä¼šè¿”å›å“åº”</li>
<li>data block: å­˜å‚¨çš„æ•°æ®</li>
</ul>
</li>
<li>
<p>CAS å‘½ä»¤</p>
<p><code>cas &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; &lt;cas unique&gt; [noreply]\r\n &lt;data block&gt; \r\n</code></p>
<ul>
<li>cas unique: 64 ä½æ— ç¬¦å·æ•´æ•°ã€‚ä½¿ç”¨ cas å‰éœ€è¦å…ˆé€šè¿‡ gets è·å–åˆ° token(cas unique)ï¼Œä½¿ç”¨ cas æ—¶æºå¸¦è¿™ä¸ª tokenï¼Œå¦åˆ™ä¼šæ“ä½œå¤±è´¥ã€‚</li>
<li>å…¶ä»–å‚æ•°å’Œå­˜å‚¨å‘½ä»¤ä¸€è‡´</li>
</ul>
</li>
</ul>
<table>
  <thead>
      <tr>
          <th>å‘½ä»¤</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>set</td>
          <td>å­˜å‚¨æ•°æ®ï¼Œä¼šè¦†ç›–ä»»ä½•ç°æœ‰æ•°æ® <br></td>
      </tr>
      <tr>
          <td>add</td>
          <td>ä»…å½“è¯¥æ•°æ®å°šä¸å­˜åœ¨æ—¶æ‰å­˜å‚¨è¯¥æ•°æ® <br></td>
      </tr>
      <tr>
          <td>replace</td>
          <td>æ›¿æ¢æ•°æ®ï¼Œä½†å‰ææ˜¯è¯¥æ•°æ®å·²å­˜åœ¨ <br></td>
      </tr>
      <tr>
          <td>append</td>
          <td>åœ¨ç°æœ‰æ•°æ®å­—èŠ‚ä¹‹åè¿½åŠ æ•°æ® <br></td>
      </tr>
      <tr>
          <td>prepend</td>
          <td>åœ¨ç°æœ‰æ•°æ®å­—èŠ‚ä¹‹å‰è¿½åŠ æ•°æ® <br></td>
      </tr>
      <tr>
          <td>cas</td>
          <td>æ£€æŸ¥å¹¶è®¾ç½®ï¼Œç”¨äºå®ç°ä¹è§‚é” <br></td>
      </tr>
  </tbody>
</table>
<h4 id="retrieval-commands">
  Retrieval Commands
  <a class="anchor" href="#retrieval-commands">#</a>
</h4>
<table>
  <thead>
      <tr>
          <th>å‘½ä»¤</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>get</td>
          <td>è·å–æ•°æ® <br> <code>get key1 key2 ... keyn \r\n</code></td>
      </tr>
      <tr>
          <td>gets</td>
          <td>è·å–æ•°æ®å’Œ CAS å€¼ <br> <code>gets key1 key2 ... keyn \r\n</code></td>
      </tr>
  </tbody>
</table>
<h4 id="statistics-commands">
  Statistics Commands
  <a class="anchor" href="#statistics-commands">#</a>
</h4>
<blockquote>
<p>å…³äº stats çš„è¯¦ç»†å­—æ®µè§£é‡ŠæŸ¥é˜…ï¼š<a href="https://github.com/memcached/memcached/blob/7d6bc7b09e3c6bb8eaff8b2b3d78d01e0bf17f6f/doc/protocol.txt#L1299-L1451">https://github.com/memcached/memcached/blob/7d6bc7b09e3c6bb8eaff8b2b3d78d01e0bf17f6f/doc/protocol.txt#L1299-L1451</a></p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>å‘½ä»¤</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>stats</td>
          <td>åŸºæœ¬ç»Ÿè®¡å‘½ä»¤ <br> <code>stats \r\n</code></td>
      </tr>
      <tr>
          <td>stats items</td>
          <td>è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ <br> <code>stats items \r\n</code></td>
      </tr>
      <tr>
          <td>stats slabs</td>
          <td>è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ <br> <code>stats slabs \r\n</code></td>
      </tr>
      <tr>
          <td>stats sizes</td>
          <td>è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ <br> <code>stats sizes \r\n</code></td>
      </tr>
  </tbody>
</table>
<h4 id="other-commands">
  Other Commands
  <a class="anchor" href="#other-commands">#</a>
</h4>
<table>
  <thead>
      <tr>
          <th>å‘½ä»¤</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>version</td>
          <td>è·å–æœåŠ¡å™¨ç‰ˆæœ¬ä¿¡æ¯ <br> <code>version \r\n</code></td>
      </tr>
      <tr>
          <td>quit</td>
          <td>å…³é—­è¿æ¥ <br> <code>quit \r\n</code></td>
      </tr>
      <tr>
          <td>flush_all</td>
          <td>æ¸…ç©ºæ‰€æœ‰æ•°æ® <br> <code>flush_all \r\n</code></td>
      </tr>
      <tr>
          <td>delete</td>
          <td>åˆ é™¤æ•°æ® <br> <code>delete key \r\n</code></td>
      </tr>
      <tr>
          <td>incr/decr</td>
          <td>valueä¸ºæ— ç¬¦å· 64 ä½æ•´æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå¯ä»¥è¿›è¡Œé€’å¢/é€’å‡æ“ä½œã€‚key ä¸å­˜åœ¨ä¼šæ“ä½œå¤±è´¥ã€‚<br> <code>incr key value \r\n</code></td>
      </tr>
  </tbody>
</table>
<h3 id="meta-text-protocol">
  Meta Text Protocol
  <a class="anchor" href="#meta-text-protocol">#</a>
</h3>
<blockquote class="book-hint danger">
<p>å…ƒæ–‡æœ¬åè®®ä¸­ä¼šå‡ºç°å¤§é‡çš„ token å­—æ ·çš„æè¿°, å…¶æŒ‡ä»£çš„æ˜¯è·Ÿåœ¨ flag åé¢ â€œè¯­æ³•å•å…ƒâ€ æˆ– ç†è§£ä¸ºflags å‚æ•°äº¦å¯ã€‚
å¦‚ <code>mg foo k v R30</code> ä¸­ï¼Œ<code>R</code> å°±æ˜¯ä¸€ä¸ª flag, <code>30</code> å°±æ˜¯å°±æ˜¯ <code>R</code> æºå¸¦çš„tokenã€‚</p>
</blockquote>
<p>å…ƒæ–‡æœ¬åè®®ï¼ˆMeta Text Protocolï¼‰æ˜¯ memcached 1.6.0 ç‰ˆæœ¬å¼•å…¥çš„æ–°åè®®ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„åè®®ï¼Œç”¨äºæ”¯æŒ memcached çš„å…ƒæ•°æ®æ“ä½œã€‚ç›¸æ¯”äºæ ‡å‡†æ–‡æœ¬åè®®ï¼Œå…ƒæ–‡æœ¬åè®®æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¼•å…¥äº†æ–°å‘½ä»¤å’Œï¼ˆä½¿ç”¨ ms æ¥å–ä»£ setï¼›mg æ¥å–ä»£ getï¼Œgets, touch, GAT, GATS ç­‰ï¼‰</li>
<li>æ–°å¢äº†å…ƒæ•°æ®æ ‡å¿—ï¼Œå¦‚ l æ ‡å¿—è‡ªä¸Šä¸€æ¬¡è®¿é—®ä»¥æ¥çš„ç§’æ•°ï¼Œh è¡¨ç¤ºè‡ªå­˜å‚¨ä»¥æ¥æ˜¯å¦è¢«è®¿é—®è¿‡ï¼Œt è¡¨ç¤ºè¿‡æœŸå‰å‰©ä½™çš„ç§’æ•°ã€‚</li>
<li>æ”¯æŒ key é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼ˆä¼ è¾“æ—¶éœ€è¦ä½¿ç”¨ base64 ç¼–ç ï¼‰</li>
<li>æ”¯æŒåŸå­æ€§æ“ä½œ</li>
<li>æ”¯æŒå¯¹é¢‘ç¹è®¿é—®çš„å¯¹è±¡è¿›è¡Œæå‰ç¼“å­˜ã€‚é€šè¿‡ R æ ‡å¿—ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢æ—¶å°±æŒ‡ç¤ºæœåŠ¡å™¨åˆ·æ–°ç¼“å­˜ã€‚</li>
</ul>
<p>æ–°å¢çš„å‘½ä»¤æœ‰ï¼šms(meta set), mg(meta get), md(meta delete), me(meta debug) ç­‰ã€‚</p>
<h4 id="meta-set-å‘½ä»¤ms">
  Meta Set å‘½ä»¤ï¼šms
  <a class="anchor" href="#meta-set-%e5%91%bd%e4%bb%a4ms">#</a>
</h4>
<blockquote>
<p>è¯¦ç»†çš„åè®®æ–‡æ¡£å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/memcached/memcached/blob/master/doc/protocol.txt#L685">https://github.com/memcached/memcached/blob/master/doc/protocol.txt#L685</a></p>
</blockquote>
<p>åœ¨å…ƒæ–‡æœ¬åè®®ä¸­ï¼Œè¯·æ±‚çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>ms &lt;key&gt; &lt;datalen&gt; &lt;flags&gt;<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>&lt;data block&gt;<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å“åº”</span>
</span></span><span style="display:flex;"><span>&lt;CD&gt; &lt;flags&gt;<span style="color:#ae81ff">\r\n</span>
</span></span></code></pre></div><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># è®¾ç½®ä¸€ä¸ª key=foo, value=bar çš„æ•°æ®, å…¶ä¸­ T90 è¡¨ç¤º 90 ç§’åè¿‡æœŸ, F1 è¡¨ç¤º flags=1</span>
</span></span><span style="display:flex;"><span>ms foo <span style="color:#ae81ff">3</span> T90 F1<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>bar<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å“åº”</span>
</span></span><span style="display:flex;"><span>HD
</span></span></code></pre></div><blockquote>
<p>ms å“åº”çš„ CD æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<p><code>HD</code> STORED æˆåŠŸã€‚</p>
<p><code>NS</code> NOT_STORED æ•°æ®å› ä¸ºé”™è¯¯è€Œæœªå­˜å‚¨ã€‚</p>
<p><code>EX</code> EXISTS æ•°æ®å·²ç»å­˜åœ¨ï¼Œå¾€å¾€æ˜¯ CAS è¯­ä¹‰ï¼Œtokenå¤±æ•ˆçš„ç»“æœã€‚</p>
<p><code>NF</code> NOT_FOUND æ•°æ®ä¸å­˜åœ¨, å¾€å¾€æ˜¯ CAS è¯­ä¹‰ï¼Œkey ä¸å­˜åœ¨çš„ç»“æœã€‚</p>
</blockquote>
<p>ms æ”¯æŒçš„ flags æ ‡å¿—å¦‚ä¸‹ï¼š</p>
<table>
  <thead>
      <tr>
          <th>Flags</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>b</td>
          <td>key é‡‡ç”¨ base64 ç¼–ç </td>
      </tr>
      <tr>
          <td>c</td>
          <td>å­˜å‚¨æˆåŠŸåˆ™è¿”å› cas tokenï¼Œå¦åˆ™è¿”å›0ï¼ˆä½† 0 ä¸èƒ½ä½œä¸ºåˆ¤æ–­æˆåŠŸå¤±è´¥çš„ä¾æ®ï¼‰ã€‚</td>
      </tr>
      <tr>
          <td>C(token)</td>
          <td>æ¯”è¾ƒ CAS å€¼ï¼Œå¦‚æœ token ä¸æœåŠ¡å™¨çš„ CAS å€¼ä¸ä¸€è‡´åˆ™æ“ä½œå¤±è´¥ã€‚å¯ä»¥é…åˆ <code>I</code> æ ‡è®°ä½¿ç”¨</td>
      </tr>
      <tr>
          <td>E(token)</td>
          <td>ä½¿ç”¨ token ä½œä¸ºæ–°çš„ CAS å€¼ï¼Œå¦‚æœ item è¢«ä¿®æ”¹</td>
      </tr>
      <tr>
          <td>F(token)</td>
          <td>è®¾ç½® client flags (32bit)</td>
      </tr>
      <tr>
          <td>I</td>
          <td>ä½¿ item å¤±æ•ˆï¼Œå¦‚æœæä¾›çš„ CAS å€¼æ¯” item çš„ CAS å€¼æ—§åˆ™æ“ä½œå¤±è´¥</td>
      </tr>
      <tr>
          <td>k</td>
          <td>æŠŠ key ä½œä¸º token è¿”å›ï¼ˆmg é»˜è®¤ä¸å›æºå¸¦ key, é‚£ä¹ˆå¯ä»¥é€šè¿‡æ­¤ flag è¿”å›ï¼‰</td>
      </tr>
      <tr>
          <td>O(token)</td>
          <td>é€æ˜å€¼, ä¼šåŸå°ä¸åŠ¨çš„è¿”å›</td>
      </tr>
      <tr>
          <td>q</td>
          <td>ä½¿ç”¨ noreply è¯­ä¹‰</td>
      </tr>
      <tr>
          <td>s</td>
          <td>è¿”å› item å­—èŠ‚å¤§å°</td>
      </tr>
      <tr>
          <td>T(token)</td>
          <td>è®¾ç½® item çš„ TTL</td>
      </tr>
      <tr>
          <td>M(token)</td>
          <td>æ¨¡å¼åˆ‡æ¢,é»˜è®¤ Setã€‚Token å¯é€‰å€¼ E(add), A(Append), P(Prepend), R(Replace) , S(Set)</td>
      </tr>
      <tr>
          <td>N(token)</td>
          <td>å¦‚æœæ˜¯ append æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ itemï¼Œæ¥å— TTL ä½œä¸ºå‚æ•°</td>
      </tr>
  </tbody>
</table>
<h4 id="meta-get-å‘½ä»¤mg">
  Meta Get å‘½ä»¤ï¼šmg
  <a class="anchor" href="#meta-get-%e5%91%bd%e4%bb%a4mg">#</a>
</h4>
<blockquote>
<p>è¯¦ç»†çš„åè®®æ–‡æ¡£å¯ä»¥å‚è€ƒï¼š[https://github.com/memcached/memcached/blob/master/doc/protocol.txt#L685</p>
</blockquote>
<p><code>mg</code> å‘½ä»¤ç”¨äºè·å–æ•°æ®ï¼Œè¯·æ±‚çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>mg &lt;key&gt; &lt;flags&gt;<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å“åº”</span>
</span></span><span style="display:flex;"><span>&lt;CD&gt; &lt;flags&gt; &lt;flags token&gt;<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span>&lt;data block&gt;<span style="color:#ae81ff">\r\n</span>
</span></span></code></pre></div><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># è·å– key=foo çš„æ•°æ®, v è¡¨ç¤º valueï¼Œt è¡¨ç¤ºè¿‡æœŸæ—¶é—´ï¼Œf è¡¨ç¤º flags</span>
</span></span><span style="display:flex;"><span>mg foo t f v<span style="color:#ae81ff">\r\n</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å“åº”</span>
</span></span><span style="display:flex;"><span>VA <span style="color:#ae81ff">3</span> t79 f1
</span></span><span style="display:flex;"><span>bat
</span></span></code></pre></div><blockquote>
<p>mg å“åº”çš„ CD æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<p><code>VA &lt;size&gt; &lt;flags&gt;\r\n &lt;data block&gt;\r\n</code> å¦‚æœä½¿ç”¨äº† v æ ‡å¿— ä¸” æœåŠ¡å™¨æœ‰æ•°æ®ã€‚</p>
<p><code>HD &lt;flags&gt;\r\n</code> å¦‚æœæ²¡æœ‰ä½¿ç”¨ v æ ‡å¿—ã€‚</p>
<p><code>EN\r\n</code> ä»£è¡¨ key ä¸å­˜åœ¨ã€‚</p>
</blockquote>
<p>mg æ”¯æŒçš„ flags æ ‡å¿—å¦‚ä¸‹ï¼š</p>
<table>
  <thead>
      <tr>
          <th>Flags</th>
          <th>è¯´æ˜</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>b</td>
          <td>key é‡‡ç”¨ base64 ç¼–ç </td>
      </tr>
      <tr>
          <td>c</td>
          <td>è¿”å› cas token</td>
      </tr>
      <tr>
          <td>f</td>
          <td>è¿”å› client flags token</td>
      </tr>
      <tr>
          <td>h</td>
          <td>è¿”å›æ˜¯å¦è¢«è®¿é—®è¿‡çš„æ ‡å¿—</td>
      </tr>
      <tr>
          <td>k</td>
          <td>è¿”å› key</td>
      </tr>
      <tr>
          <td>l</td>
          <td>è¿”å›è‡ªä¸Šæ¬¡è®¿é—®ä»¥æ¥çš„ç§’æ•°</td>
      </tr>
      <tr>
          <td>O</td>
          <td>é€æ˜å€¼</td>
      </tr>
      <tr>
          <td>q</td>
          <td>ä½¿ç”¨ noreply è¯­ä¹‰</td>
      </tr>
      <tr>
          <td>s</td>
          <td>è¿”å› item å¤§å°</td>
      </tr>
      <tr>
          <td>t</td>
          <td>è¿”å›å‰©ä½™çš„ TTL</td>
      </tr>
      <tr>
          <td>u</td>
          <td>ä¸æ›´æ–° LRU</td>
      </tr>
      <tr>
          <td>v</td>
          <td>è¿”å› value</td>
      </tr>
      <tr>
          <td>E(token)</td>
          <td>ä½¿ç”¨ token ä½œä¸ºæ–°çš„ CAS å€¼ï¼Œå¦‚æœ item è¢«ä¿®æ”¹</td>
      </tr>
      <tr>
          <td>N(token)</td>
          <td>å¦‚æœ item ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ itemï¼Œæ¥å— TTL ä½œä¸ºå‚æ•°</td>
      </tr>
      <tr>
          <td>R(token)</td>
          <td>å¦‚æœå‰©ä½™çš„ TTL å°äº tokenï¼Œä¸º recache è€Œèƒœå‡º</td>
      </tr>
      <tr>
          <td>T(token)</td>
          <td>æ›´æ–°å‰©ä½™çš„ TTL</td>
      </tr>
  </tbody>
</table>
<p>ç”±æ­¤å¯è§ï¼Œå…ƒæ–‡æœ¬åè®®ç›¸æ¯”äºæ ‡å‡†æ–‡æœ¬åè®®æ›´åŠ çµæ´»ï¼Œæ”¯æŒæ›´å¤šçš„å…ƒæ•°æ®æ“ä½œã€‚å°¤å…¶æ˜¯ mg è·Ÿ flags çš„ç»“åˆæ›´åŠ çµæ´»ï¼Œå°†ä»¥å‰éœ€è¦æ‰§è¡Œå¤šä¸ªå‘½ä»¤çš„æ“ä½œåˆå¹¶åˆ°äº†ä¸€ä¸ªå‘½ä»¤ä¸­ï¼Œå‡å°‘äº†ç½‘ç»œå¾€è¿”çš„æ¬¡æ•°ã€‚</p>
<blockquote class="book-hint info">
<p>å…ƒæ–‡æœ¬åè®®ä¸­å½“ç„¶ä¸æ­¢è¿™ä¸¤ä¸ªå‘½ä»¤ï¼Œè¿˜æœ‰ md, me ç­‰å‘½ä»¤ï¼Œå°±ä¸å†ä¸€ä¸€åˆ—ä¸¾äº†ã€‚é€šè¿‡ ms, mg å‘½ä»¤å°±è¶³å¤ŸæŒæ¡äº†å…ƒæ–‡æœ¬åè®®çš„è®¾è®¡ç†å¿µå’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
</blockquote>
<h2 id="æŠ“åŒ…æºç åˆ†æ">
  æŠ“åŒ…/æºç åˆ†æ
  <a class="anchor" href="#%e6%8a%93%e5%8c%85%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90">#</a>
</h2>
<p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡æŠ“åŒ…çš„æ–¹å¼æ¥åˆ†æ memcached çš„åè®®äº¤äº’è¿‡ç¨‹ï¼Œå†ç»“åˆä¸€éƒ¨åˆ†æºç æ¥åˆ†æä¸‹ memcached æ˜¯æ€ä¹ˆæ”¯æŒâ€œåˆ†å¸ƒå¼â€åœºæ™¯çš„ã€‚</p>
<h3 id="åˆ†æ0-memcached-çš„åè®®é•¿ä»€ä¹ˆæ ·">
  åˆ†æ0: memcached çš„åè®®é•¿ä»€ä¹ˆæ ·ï¼Ÿ
  <a class="anchor" href="#%e5%88%86%e6%9e%900-memcached-%e7%9a%84%e5%8d%8f%e8%ae%ae%e9%95%bf%e4%bb%80%e4%b9%88%e6%a0%b7">#</a>
</h3>
<p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦æŠ“åŒ…ï¼Œä» memcached çš„åè®®ä»‹ç»æˆ‘ä»¬å°±å·²ç»çŸ¥é“äº†å®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬åè®®ï¼Œç›´æ¥ä½¿ç”¨ telnet å°±å¯ä»¥å®Œæˆ memcached çš„åŸºæœ¬æ“ä½œã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ª telnet ä»è¿æ¥åˆ° set å¹¶ get çš„å®Œæ•´æŠ“åŒ…æˆªå›¾ï¼š</p>
<p><img src="/images/memcached/memcached-protocol.jpeg" alt="memcached åè®®æŠ“åŒ…" /></p>
<p>ä»æˆªå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡ä¸‰æ¬¡æ¡æ‰‹åï¼Œå®¢æˆ·ç«¯å‘é€äº† <code>ms foo 3 t90\r\nbar\r\n</code> å‘½ä»¤ï¼Œç„¶å memcached æœåŠ¡å™¨è¿”å›äº† <code>HD</code> è¡¨ç¤ºå­˜å‚¨æˆåŠŸã€‚æ¥ç€å®¢æˆ·ç«¯å‘é€äº† <code>mg foo t f v\r\n</code> å‘½ä»¤ï¼Œmemcached æœåŠ¡å™¨è¿”å›äº† <code>VA 3 t-1 s3\r\nbar\r\n</code> è¡¨ç¤ºè·å–æˆåŠŸã€‚</p>
<p>éƒ½éå¸¸çš„ç›´è§‚ï¼Œè¿™é‡Œå”¯ä¸€éœ€è¦æ³¨æ„ t90 è¿™ ä¸ªflag ä½¿ç”¨é”™äº†ï¼Œåº”è¯¥æ˜¯ T90ï¼Œè¡¨ç¤º 90 ç§’åè¿‡æœŸï¼Œä½†æ˜¯ memcached æœåŠ¡å™¨å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œè€Œæ˜¯ç›´æ¥å­˜å‚¨äº† -1 è¡¨ç¤ºæ°¸ä¸è¿‡æœŸã€‚</p>
<p>å¦å¤–æˆ‘ä»¬ä¹Ÿä¼šæ³¨æ„åˆ°telnetå®¢æˆ·ç«¯å‘é€ <code>ms foo 3 t90\r\nbar\r\n</code> æ˜¯åˆ†æˆäº†ä¸¤ä¸ª TCP åŒ…å‘é€çš„ï¼Œè¿™æ˜¯å› ä¸º telnet é»˜è®¤æ˜¯è¡Œç¼“å†²æ¨¡å¼ï¼Œéœ€è¦æŒ‰ä¸‹å›è½¦é”®æ‰ä¼šå‘é€æ•°æ®ã€‚</p>
<h3 id="åˆ†æ1-memcached-é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„">
  åˆ†æ1: memcached é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
  <a class="anchor" href="#%e5%88%86%e6%9e%901-memcached-%e9%9b%86%e7%be%a4%e6%98%af%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c%e7%9a%84">#</a>
</h3>
<p>æˆ‘ä»¬é€šå¸¸çœ‹åˆ° memcached çš„ä»‹ç»éƒ½ä¼šè¯´ memcached æ˜¯ä¸€ä¸ªâ€œåˆ†å¸ƒå¼â€ç¼“å­˜ç³»ç»Ÿï¼Œé‚£ä¹ˆ memcached æ˜¯å¦‚ä½•æ”¯æŒåˆ†å¸ƒå¼åœºæ™¯çš„å‘¢ï¼Ÿä»å®˜æ–¹æ–‡æ¡£ä¸­æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°è¿™æ ·çš„æè¿°ï¼š</p>
<blockquote>
<p><em><strong><a href="https://docs.memcached.org/#logic-half-in-client-half-in-server">Logic Half in Client, Half in Server</a></strong></em></p>
<p><em><strong>A â€œmemcached implementationâ€ is partially in a client, and partially in a server. Clients understand how to choose which server to read or write to for an item, what to do when it cannot contact a server.</strong></em></p>
<p><em><strong><a href="https://docs.memcached.org/#servers-are-disconnected-from-each-other">Servers are Disconnected From Each Other</a></strong></em></p>
<p><em><strong>Memcached servers are unaware of each other. There is no crosstalk, no synchronization, no broadcasting, no replication. Adding servers increases the available memory. Cache invalidation is simplified, as clients delete or overwrite data on the server which owns it directly.</strong></em></p>
</blockquote>
<p>æ„æ€å…¶å®å¾ˆç®€å•ï¼Œè™½ç„¶ memcached æ˜¯ä¸€ä¸ªâ€œåˆ†å¸ƒå¼â€ç¼“å­˜ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒçš„åˆ†å¸ƒå¼æ˜¯éœ€è¦å®¢æˆ·ç«¯é…åˆçš„ä¼ªåˆ†å¸ƒå¼ï¼Œè€Œä¸æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„åˆ†å¸ƒå¼ã€‚å®ƒæ‰€æ”¯æŒçš„åˆ†å¸ƒå¼æ˜¯æŒ‡å®¢æˆ·ç«¯å¯ä»¥é‡‡å–åˆ†ç‰‡ç®—æ³•æ¥å†³å®šæ•°æ®å­˜å‚¨åœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šï¼Œè€Œ memcached æœåŠ¡å™¨æœ¬èº«æ˜¯ä¸ä¼šç›¸äº’é€šä¿¡çš„ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œæ•°æ®åŒæ­¥çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/images/memcached/memcached-distributed.svg" alt="memcached åˆ†å¸ƒå¼" /></p>
<p>è¿™æ ·çš„è®¾è®¡æœ‰åˆ©æœ‰å¼Šï¼Œä¼˜ç‚¹æ˜¯ memcached æœåŠ¡å™¨ä¹‹é—´ä¸éœ€è¦ç›¸äº’é€šä¿¡ï¼Œä¸éœ€è¦åŒæ­¥æ•°æ®ï¼Œå› æ­¤ memcached æœåŠ¡å™¨å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰©å±•ï¼Œåªéœ€è¦å¢åŠ æœåŠ¡å™¨å°±å¯ä»¥å¢åŠ ç¼“å­˜å®¹é‡ã€‚ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œåˆ†å¸ƒå¼çš„ç‰¹æ€§éœ€è¦å®¢æˆ·ç«¯æ¥å®ç°ï¼Œè¿™å°±éœ€è¦å®¢æˆ·ç«¯æœ‰ä¸€å®šçš„åˆ†ç‰‡ç®—æ³•ï¼Œå¦‚æœæƒ³è¦å®ç°é«˜å¯ç”¨(æŸå°æœºå™¨å®•æœº)ï¼Œè¿˜éœ€è¦å®¢æˆ·ç«¯æ”¯æŒâ€œå¤åˆ¶â€æœºåˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ï¼ŒæŠ“åŒ…æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š</p>
<details ><summary>éƒ¨ç½² memcached é›†ç¾¤</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#75715e"># é€šè¿‡ docker å¯åŠ¨ä¸¤ä¸ª memcached å®ä¾‹, åˆ†åˆ«ç›‘å¬å®¿ä¸»æœºçš„ 11211 å’Œ 11212 ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">version</span>: <span style="color:#e6db74">&#39;3&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">memcached1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">memcached:1.5.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;11211:11211&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">memcached2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">image</span>: <span style="color:#ae81ff">memcached:1.5.6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#e6db74">&#34;11212:11211&#34;</span>
</span></span></code></pre></div>  </div>
</details>
<details ><summary>å®¢æˆ·ç«¯ä»£ç </summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pymemcache.client.hash <span style="color:#f92672">import</span> HashClient
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>client <span style="color:#f92672">=</span> HashClient([
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;127.0.0.1:11211&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;127.0.0.1:11212&#34;</span>,
</span></span><span style="display:flex;"><span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>client<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;key-0&#34;</span>, <span style="color:#e6db74">&#34;I&#39;ll be sent to node1(11211)&#34;</span>, expire<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
</span></span><span style="display:flex;"><span>client<span style="color:#f92672">.</span>set(<span style="color:#e6db74">&#34;key-2&#34;</span>, <span style="color:#e6db74">&#34;I&#39;ll be sent to node2(11212)&#34;</span>, expire<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>)
</span></span></code></pre></div>  </div>
</details>
<p>é€šè¿‡ wirehsark æŠ“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯æŒ‰ç…§é¢„æœŸå‘é€äº†ä¸¤ä¸ª set å‘½ä»¤ï¼Œåˆ†åˆ«å­˜å‚¨åœ¨ 11211 å’Œ 11212 ç«¯å£çš„ memcached æœåŠ¡å™¨ä¸Šï¼š</p>
<p><img src="/images/memcached/memcached-cluster-wireshark.jpeg" alt="memcached åˆ†å¸ƒå¼æŠ“åŒ…" /></p>
<p>è€Œå®¢æˆ·ç«¯ï¼ˆpymemcacheï¼‰çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œé€šè¿‡ä½¿ç”¨ <code>Rendezvous Hashing</code> ç®—æ³•æ¥è®¡ç®—ç»„åˆ key (node-$key) çš„ hash å€¼ï¼Œé€‰æ‹© score æœ€é«˜çš„æœåŠ¡å™¨ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># self.hash_function = lambda x: murmur3_32(x)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_node</span>(self, key):
</span></span><span style="display:flex;"><span>    high_score <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    winner <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> node <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>nodes:
</span></span><span style="display:flex;"><span>        score <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>hash_function(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>node<span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">{</span>key<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&gt;</span> high_score:
</span></span><span style="display:flex;"><span>            (high_score, winner) <span style="color:#f92672">=</span> (score, node)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> score <span style="color:#f92672">==</span> high_score:
</span></span><span style="display:flex;"><span>            (high_score, winner) <span style="color:#f92672">=</span> (score, max(str(node), str(winner)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> winner
</span></span></code></pre></div><blockquote class="book-hint warning">
<p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯ï¼Œå®¢æˆ·ç«¯çš„åšæ³•ä¸æ˜¯éå¸¸å¸¸è§çš„ hash å–æ¨¡çš„æ–¹å¼ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç§å«åš HRWï¼ˆHighest Random Weightï¼‰Hashing çš„ç®—æ³•ï¼Œè¿™ç§ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å½“èŠ‚ç‚¹å¢åŠ æˆ–è€…å‡å°‘æ—¶ï¼Œå½±å“çš„æ•°æ®é‡æœ€å°ï¼Œè€Œä¸”ä¸éœ€è¦ç»´æŠ¤ä¸€è‡´æ€§å“ˆå¸Œç¯ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼ˆnode1, node2, node3ï¼‰ï¼Œkey1 -&gt; node1ï¼Œkey2 -&gt; node2ï¼Œkey3 -&gt; node3</p>
<p>å¦‚æœ node2 æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæœ€åçš„æƒ…å†µä¸‹ï¼škey1-&gt; node3ï¼Œkey2 -&gt; node3ï¼Œkey3 -&gt; node1ï¼Œè¿™æ‰€æœ‰çš„ key éƒ½è¦é‡æ–°åˆ†é…ã€‚</p>
<p>è€Œ HRW ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ï¼šå½“ node2 æŒ‚æ‰äº†ï¼Œåªæœ‰ key2 -&gt; node3 éœ€è¦é‡æ–°åˆ†é…ï¼Œå…¶ä»–çš„ key ä»ç„¶ä¿æŒåŸæ¥çš„åˆ†é…ï¼Œè¿™æ˜¯å› ä¸ºä¸€å¼€å§‹ key1 -&gt; node1 å°±å·²ç»æ˜¯æœ€é«˜ï¼Œé‚£ä¹ˆèŠ‚ç‚¹å‡å°‘è¿™ä¸ªçŠ¶å†µä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
</blockquote>
<h3 id="åˆ†æ2-å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«">
  åˆ†æ2: å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
  <a class="anchor" href="#%e5%88%86%e6%9e%902-%e5%85%83%e6%96%87%e6%9c%ac%e5%8d%8f%e8%ae%ae%e6%9c%89%e4%bb%80%e4%b9%88%e5%8c%ba%e5%88%ab">#</a>
</h3>
<p>é¡¾åæ€ä¹‰ï¼Œå…ƒæ–‡æœ¬åè®®è¿˜æ˜¯åŸºäºæ–‡æœ¬çš„ï¼Œä½†æ˜¯å®ƒå¼•å…¥äº†æ›´å¤šçš„å…ƒæ•°æ®æ ‡å¿—ï¼Œé€šè¿‡æ ‡å¿—çš„ç»„åˆé¿å…äº†å¤šæ¬¡ç½‘ç»œå¾€è¿”çš„é—®é¢˜ï¼Œè¿™å¯¹äºéœ€è¦ä¼˜åŒ– memcached ä½¿ç”¨åœºæ™¯æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
<p>ä½†æ˜¯è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ memcached å†…éƒ¨æ˜¯æ€ä¹ˆå¤„ç†å…ƒæ–‡æœ¬åè®®çš„ï¼Œä»¥ä¸‹æ˜¯ memcached æºç ä¸­å¯¹äºå…ƒæ–‡æœ¬åè®®çš„å¤„ç†ï¼š</p>
<details open><summary>åè®®è§£æç‰‡æ®µ</summary>
  <div class="markdown-inner">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">process_command_ascii</span>(conn <span style="color:#f92672">*</span>c, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>command) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Meta commands are all 2-char in length.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">char</span> first <span style="color:#f92672">=</span> tokens[COMMAND_TOKEN].value[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;m&#39;</span> <span style="color:#f92672">&amp;&amp;</span> tokens[COMMAND_TOKEN].length <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">switch</span> (tokens[COMMAND_TOKEN].value[<span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;g&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">process_mget_command</span>(c, tokens, ntokens);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;s&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">process_mset_command</span>(c, tokens, ntokens);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;g&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Various get commands are very common.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#a6e22e">WANT_TOKENS_MIN</span>(ntokens, <span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;get&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">process_get_command</span>(c, tokens, ntokens, false, false);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;s&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;set&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> (comm <span style="color:#f92672">=</span> NREAD_SET)) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">WANT_TOKENS_OR</span>(ntokens, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">process_update_command</span>(c, tokens, ntokens, comm, false);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;stats&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">process_stat</span>(c, tokens, ntokens);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">out_string</span>(c, <span style="color:#e6db74">&#34;ERROR&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;d&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;delete&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">WANT_TOKENS</span>(ntokens, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">process_delete_command</span>(c, tokens, ntokens);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">out_string</span>(c, <span style="color:#e6db74">&#34;ERROR&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (first <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;t&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;touch&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">WANT_TOKENS_OR</span>(ntokens, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">process_touch_command</span>(c, tokens, ntokens);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">out_string</span>(c, <span style="color:#e6db74">&#34;ERROR&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;version&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">process_version_command</span>(c);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">strcmp</span>(tokens[COMMAND_TOKEN].value, <span style="color:#e6db74">&#34;quit&#34;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">process_quit_command</span>(c);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ... çœç•¥éƒ¨åˆ†ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>  </div>
</details>
<p>å¯ä»¥çœ‹åˆ° meta åè®®æ˜¯åœ¨æ–‡æœ¬åè®®ä¹‹å‰çš„ï¼Œé€šè¿‡åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ <code>m</code> æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ meta åè®®ï¼Œç„¶åå†æ ¹æ®ç¬¬äºŒä¸ªå­—ç¬¦æ¥åˆ¤æ–­å…·ä½“çš„ meta å‘½ä»¤ã€‚è‡³äºå†…éƒ¨çš„å¤„ç†é€»è¾‘ï¼Œå¤§ä½“æµç¨‹ä¸Šå’Œæ–‡æœ¬åè®®æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨å‘½ä»¤ä¸­å¢åŠ äº†æ›´å¤šçš„å…ƒæ•°æ®æ ‡å¿—ï¼Œè¿™é‡Œå°±ä¸å†å±•å¼€äº†ã€‚</p>
<h2 id="æ–‡æœ¬åè®®æ¢³ç†">
  æ–‡æœ¬åè®®æ¢³ç†
  <a class="anchor" href="#%e6%96%87%e6%9c%ac%e5%8d%8f%e8%ae%ae%e6%a2%b3%e7%90%86">#</a>
</h2>
<blockquote>
<p>ğŸŸ© æ ‡è®°çš„æ˜¯æ ‡å‡†æ–‡æœ¬åè®®çš„å‘½ä»¤
â­•ï¸ æ ‡è®°çš„æ˜¯å…ƒæ–‡æœ¬åè®®çš„å‘½ä»¤</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>Command</th>
          <th>Usage</th>
          <th>Description</th>
          <th>Remark</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>set</td>
          <td><code>set &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; [noreply]\r\n&lt;data block&gt;\r\n</code></td>
          <td>Stores data.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>add</td>
          <td><code>add &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; [noreply]\r\n&lt;data block&gt;\r\n</code></td>
          <td>Stores data only if the server doesn&rsquo;t already hold data for this key.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>replace</td>
          <td><code>replace &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; [noreply]\r\n&lt;data block&gt;\r\n</code></td>
          <td>Stores data only if the server already holds data for this key.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>append</td>
          <td><code>append &lt;key&gt; &lt;bytes&gt; [noreply]\r\n&lt;data block&gt;\r\n</code></td>
          <td>Appends data to an existing key.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>prepend</td>
          <td><code>prepend &lt;key&gt; &lt;bytes&gt; [noreply]\r\n</code></td>
          <td>Prepends data to an existing key.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>cas</td>
          <td><code>cas &lt;key&gt; &lt;flags&gt; &lt;exptime&gt; &lt;bytes&gt; &lt;cas unique&gt; [noreply]\r\n&lt;data block&gt;\r\n</code></td>
          <td>&ldquo;Check and set&rdquo; operation; stores data only if no one else has updated since it was last fetched.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>ms (Meta Set)</td>
          <td><code>ms &lt;key&gt; &lt;datalen&gt; &lt;flags&gt;*\r\n&lt;data block&gt;\r\n</code></td>
          <td>Generic command for storing data to memcached.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>get</td>
          <td><code>get &lt;key&gt;*\r\n</code></td>
          <td>Retrieves data for one or more keys.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>gets</td>
          <td><code>gets &lt;key&gt;*\r\n</code></td>
          <td>Retrieves data for one or more keys, including CAS unique values.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>gat</td>
          <td><code>gat &lt;exptime&gt; &lt;key&gt;*\r\n</code></td>
          <td>Retrieves data and updates the expiration time of existing items.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>gats</td>
          <td><code>gats &lt;exptime&gt; &lt;key&gt;*\r\n</code></td>
          <td>Retrieves data and updates the expiration time of existing items, including CAS unique values.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>mg (Meta Get)</td>
          <td><code>mg &lt;key&gt; &lt;flags&gt;*\r\n</code></td>
          <td>Generic command for retrieving key data from memcached.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>delete</td>
          <td><code>delete &lt;key&gt; [noreply]\r\n</code></td>
          <td>Explicitly deletes items.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>incr</td>
          <td><code>incr &lt;key&gt; &lt;value&gt; [noreply]\r\n</code></td>
          <td>Increments the value of an item.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>decr</td>
          <td><code>decr &lt;key&gt; &lt;value&gt; [noreply]\r\n</code></td>
          <td>Decrements the value of an item.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>touch</td>
          <td><code>touch &lt;key&gt; &lt;exptime&gt; [noreply]\r\n</code></td>
          <td>Updates the expiration time of an existing item without fetching it.</td>
          <td>ğŸŸ©</td>
      </tr>
      <tr>
          <td>me (Meta Debug)</td>
          <td><code>me &lt;key&gt; &lt;flag&gt;\r\n</code></td>
          <td>Human readable dump of all available internal metadata of an item.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>md (Meta Delete)</td>
          <td><code>md &lt;key&gt; &lt;flags&gt;*\r\n</code></td>
          <td>Explicitly deletes items, marking them as &ldquo;stale&rdquo;.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>ma (Meta Arithmetic)</td>
          <td><code>ma &lt;key&gt; &lt;flags&gt;*\r\n</code></td>
          <td>Basic operations against numerical values, replacing &ldquo;incr&rdquo; and &ldquo;decr&rdquo; commands.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>mn (Meta No-Op)</td>
          <td><code>mn\r\n</code></td>
          <td>Returns a static response code.</td>
          <td>â­•ï¸</td>
      </tr>
      <tr>
          <td>slabs reassign</td>
          <td><code>slabs reassign &lt;source class&gt; &lt;dest class&gt;\r\n</code></td>
          <td>Redistributes memory after the server hits its limit.</td>
          <td>ğŸŸ©</td>
      </tr>
  </tbody>
</table>
<h2 id="memcached-client-å®ç°">
  Memcached Client å®ç°
  <a class="anchor" href="#memcached-client-%e5%ae%9e%e7%8e%b0">#</a>
</h2>
<p>è¿™æ˜¯æˆ‘å®ç°çš„ Go è¯­è¨€ memcached client åŒ…ï¼šhttps://github.com/yeqown/memcached æ”¯æŒæ ‡å‡†æ–‡æœ¬åè®®å’Œå…ƒæ–‡æœ¬åè®®ã€è¿æ¥æ± å’Œé›†ç¾¤æ¨¡å¼ç­‰åŠŸèƒ½ï¼Œæ¬¢è¿ä½¿ç”¨å’Œåé¦ˆã€‚</p>
</div>
</article>


<section class="comment">
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
      const gitalk = new Gitalk({
          clientID: '7d8c8c91ae6aff3e46e7',
          clientSecret: '0f0f2ea4fb6eb3067955823f06286e7d88509b9f',
          repo: 'yeqown.github.io',
          owner: 'yeqown',
          admin: ['yeqown'],
          id: "", 
          distractionFreeMode: false 
      });
      (function () {
          if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
              document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
              return;
          }
          gitalk.render('gitalk-container');
      })();
  </script>
</section>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">






<div class="flex align-center">
    <span id="busuanzi_container_site_pv" style="margin-right: 10px;">
        è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>
    </span>
    <span id="busuanzi_container_site_uv" style="margin-right: 10px;">
        è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>
    </span>
</div></div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#ä»€ä¹ˆæ˜¯-memcachedhttpsmemcachedorg">ä»€ä¹ˆæ˜¯ <a href="https://memcached.org/">memcached</a></a>
      <ul>
        <li><a href="#ä¸ºä»€ä¹ˆæœ‰-redis-è¿˜è¦ä½¿ç”¨-memcached">ä¸ºä»€ä¹ˆæœ‰ redis è¿˜è¦ä½¿ç”¨ memcached</a></li>
      </ul>
    </li>
    <li><a href="#memcached-åè®®æ¦‚è§ˆ">memcached åè®®æ¦‚è§ˆ</a>
      <ul>
        <li><a href="#standard-text-protocol">Standard Text Protocol</a></li>
        <li><a href="#meta-text-protocol">Meta Text Protocol</a></li>
      </ul>
    </li>
    <li><a href="#æŠ“åŒ…æºç åˆ†æ">æŠ“åŒ…/æºç åˆ†æ</a>
      <ul>
        <li><a href="#åˆ†æ0-memcached-çš„åè®®é•¿ä»€ä¹ˆæ ·">åˆ†æ0: memcached çš„åè®®é•¿ä»€ä¹ˆæ ·ï¼Ÿ</a></li>
        <li><a href="#åˆ†æ1-memcached-é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„">åˆ†æ1: memcached é›†ç¾¤æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</a></li>
        <li><a href="#åˆ†æ2-å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«">åˆ†æ2: å…ƒæ–‡æœ¬åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></li>
      </ul>
    </li>
    <li><a href="#æ–‡æœ¬åè®®æ¢³ç†">æ–‡æœ¬åè®®æ¢³ç†</a></li>
    <li><a href="#memcached-client-å®ç°">Memcached Client å®ç°</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












