<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Apache Doris on Yeqown</title>
    <link>https://www.yeqown.xyz/tags/Apache-Doris/</link>
    <description>Recent content in Apache Doris on Yeqown</description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Tue, 14 Oct 2025 10:43:43 +0800</lastBuildDate>
    <atom:link href="https://www.yeqown.xyz/tags/Apache-Doris/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Apache Doris PreparedStatement 之谜</title>
      <link>https://www.yeqown.xyz/2025/10/14/Apache-Doris-PreparedStatement%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6/</link>
      <pubDate>Tue, 14 Oct 2025 10:43:43 +0800</pubDate>
      <guid>https://www.yeqown.xyz/2025/10/14/Apache-Doris-PreparedStatement%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6/</guid>
      <description>&lt;blockquote&gt;&#xA;&lt;p&gt;使用的 Apache Doris 版本：3.0.3, 对应的 Doris 源码如果没有特意说明，均为 3.0.3 版本。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h2 id=&#34;更新&#34;&gt;&#xA;  更新&#xA;  &lt;a class=&#34;anchor&#34; href=&#34;#%e6%9b%b4%e6%96%b0&#34;&gt;#&lt;/a&gt;&#xA;&lt;/h2&gt;&#xA;&lt;p&gt;后续又遇到了一个跟 prepared statement 相关的错误，起因是在一次迭代中将 DQ-1 的 gorm 版本从 &lt;code&gt;v1.25.5&lt;/code&gt; 升级到了 &lt;code&gt;v1.26.1&lt;/code&gt; 发现大量的 SQL 报错:&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;Error &lt;span style=&#34;color:#ae81ff&#34;&gt;1105&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;HY000&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;: errCode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; 2, detailMessage &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;\n&lt;/span&gt;mismatched input &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;LIMIT&amp;#39;&lt;/span&gt; expecting &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;&amp;lt;EOF&amp;gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;`&lt;/span&gt;）；&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;但是 SQL 没有做过任何调整, 将 SQL 复制出来在 mysql shell 中都正常运行。&lt;/p&gt;&#xA;&lt;p&gt;抓包可以发现，这个错误是在 &lt;code&gt;COM_STMT_PREPARE&lt;/code&gt; 阶段报出的, 如下图：&lt;/p&gt;&#xA;&lt;figure&gt;&#xA;    &lt;img src=&#34;https://www.yeqown.xyz/images/doris-prepared-statments/update-prepare-limit-variables.jpeg&#34; alt=&#34;update-prepare-limit-variables&#34;/&gt;&#xA;    &lt;figcaption&gt;update-prepare-limit-variables&lt;/figcaption&gt;&#xA;&lt;/figure&gt;&#xA;&lt;p&gt;经过对比和查看 &lt;code&gt;gorm&lt;/code&gt; 的发布历史，找到这样一个 PR:&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;a href=&#34;https://github.com/go-gorm/gorm/pull/6806&#34;&gt;#6806: let limit and offset use bind parameter&lt;/a&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;带来的影响就是把 &lt;code&gt;limit&lt;/code&gt; 后面的变量在 &lt;code&gt;prepare&lt;/code&gt; 阶段使用占位符号替代（之前的版本是直接使用的值而不是占位符）。恰恰 doris 还不支持如下这种语句，所以导致了上面的错误。&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;user&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;where&lt;/span&gt; id &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;limit&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;?&lt;/span&gt;;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;原因是 doris 的 SQL 语法约定了, &lt;code&gt;LIMIT&lt;/code&gt; &lt;code&gt;OFFSET&lt;/code&gt; 后面必须要跟一个整型字面量：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
